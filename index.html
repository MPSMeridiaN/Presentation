<!DOCTYPE html>

<html lang="th">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Control &amp; Instrumentation (C&amp;I) - EGAT Maintenance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Use EGAT colors for better branding uniformity
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'egat-blue': '#004d99',   /* สีน้ำเงินเข้มหลักของ EGAT */
                        'egat-yellow': '#FFD700', /* สีเหลือง/ทอง (Accent) ของ EGAT */
                    },
                }
            }
        }
    </script>
    <style>
        /* Sarabun Font Import for Thai language support and formal tone */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@100;300;400;500;600;700&family=Inter:wght@100..900&display=swap');
        
        body {
            font-family: 'Sarabun', 'Inter', sans-serif; 
            background-color: #ffffff;
	    /* ADD THIS LINE for smooth color transitions */
            transition: background-color 0.5s ease, color 0.5s ease;
            color: #000000; /* Default text color */
        }

        /* Custom scrollbar style for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #aab4c3;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7d899b;
        }
        
        /* Apply all transitions and default states via CSS for consistency */
        .content-section {
            transition: opacity 0.3s ease-in-out;
        }

        .dropdown-menu {
            display: none; 
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            min-width: 250px;
        }

        .dropdown:hover .dropdown-menu {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Active navigation link style (for JS control) */
        .nav-active-link {
            color: var(--egat-yellow, #FFD700) !important; 
            text-decoration: underline;
            text-decoration-thickness: 3px;
            text-underline-offset: 4px;
        }
        
        /* Modal Transitions: Use CSS classes that JS can toggle */
        .modal-backdrop-transition {
            transition: opacity 0.3s ease-out;
        }

        .modal-content-transition {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

	.hidden-content {
    	    max-height: 0;
    	    opacity: 0;
    	    transform: translateY(-10px);
    	    overflow: hidden;
    	    pointer-events: none;
	}

	#apiKeySection {
    	    max-height: 500px;
    	    opacity: 1;
    	    transform: translateY(0);
    	    transition: max-height 0.6s ease-in-out, opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
    	    overflow: hidden;
	}	

	#apiKeySection.hidden-content {
   	    max-height: 0;
	    opacity: 0;
	    transform: translateY(-10px);
	    pointer-events: none;
	}

	body.dark {
	    /* These colors are taken from your existing JavaScript toggle logic */
	    background-color: #1C2833; 
	    color: #EAECEE;             
	}

	.collapsible-content {
	    /* Define the open state max-height (use a large value that exceeds content height) */
	    max-height: 1000px; 
	    opacity: 1;
	    transform: translateY(0);
	    /* Apply smooth transition for opening/closing */
	    transition: max-height 0.6s ease-in-out, opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
	    overflow: hidden;
	}

	.collapsible-content.hidden-content {
	    max-height: 0; /* Fully closed */
	    opacity: 0;
	    transform: translateY(-10px);
	}	

    
.collapsible-content.expanded {
    max-height: 1000px !important;
    opacity: 1 !important;
    transform: translateY(0) !important;
    pointer-events: auto !important;
}


/* --- Unified transition timing across the entire site --- */
* {
  transition: all 0.35s ease-in-out;
}

/* Accordion, modal, dropdown, and section consistency */
.collapsible-content,
.modal-content-transition,
.modal-backdrop-transition,
.dropdown-menu,
.content-section {
  transition: all 0.35s ease-in-out;
}

/* API key section smooth collapse with zero spacing */
#apiKeySection {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  transition: max-height 0.35s ease-in-out, opacity 0.35s ease-in-out,
              transform 0.35s ease-in-out, margin 0.35s ease-in-out, padding 0.35s ease-in-out;
}

#apiKeySection.hidden-content {
  max-height: 0;
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  margin: 0 !important;
  padding: 0 !important;
}

/* Slightly adjust spacing of main header area when API box hides */
#apiKeySection.hidden-content + header,
#apiKeySection.hidden-content + header + * {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* Ensure header + main adjust smoothly */
header + main {
  transition: padding-top 0.35s ease-in-out, margin-top 0.35s ease-in-out;
}

</style>

</head>

<body class="antialiased dark">
    <header class="bg-egat-blue shadow-xl sticky top-0 z-20">
        <div class="container mx-auto px-4 py-5 md:py-6 flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-white tracking-tight">
                C&amp;I Maintenance Team
            </h1>
            <nav class="flex items-center" id="main-nav">
                <a class="nav-link text-white hover:text-egat-yellow transition duration-300 text-sm md:text-base ml-4 hover:underline nav-active-link font-bold" data-target="overview" href="#overview">Overview</a>
                <a class="nav-link text-white hover:text-egat-yellow transition duration-300 text-sm md:text-base ml-4 hover:underline" data-target="details" href="#details">Details</a>
                <div class="relative ml-4 dropdown group">
                    <a class="nav-link text-white hover:text-egat-yellow transition duration-300 text-sm md:text-base hover:underline flex items-center" data-target="training" href="#">
                        On the Job Training
                        <svg class="w-4 h-4 ml-1 transform transition duration-300 group-hover:rotate-180" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
</a>
                    <div class="dropdown-menu absolute top-full right-0 w-64 bg-egat-blue shadow-xl rounded-md overflow-hidden z-30 border border-egat-yellow/50">
                        <a class="nav-link nav-dropdown-link block px-4 py-3 text-white text-sm hover:bg-egat-blue/70 hover:text-egat-yellow transition duration-200" data-parent-target="training" data-target="combined_cycle" href="#combined_cycle">
                            Combined Cycle Power Plant
                        </a>
                        <a class="nav-link nav-dropdown-link block px-4 py-3 text-white text-sm hover:bg-egat-blue/70 hover:text-egat-yellow transition duration-200" data-parent-target="training" data-target="solar_power" href="#solar_power">
                            Solar Power Plant
                        </a>
                    </div>
                </div>
                <a class="nav-link text-white hover:text-egat-yellow transition duration-300 text-sm md:text-base ml-4 hover:underline" data-target="simulations" href="#simulations">Simulations</a></nav>
        </div>
    </header>
    <main class="container mx-auto px-4 py-10 md:py-14">
        <section class="content-section mb-16 opacity-100" id="overview">
            <div class="max-w-5xl mx-auto p-8 rounded-xl shadow-2xl bg-white border border-gray-200">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-egat-blue mb-2">
                        Control &amp; Instrumentation (C&amp;I)
                    </h2>
                    <h3 class="text-xl text-gray-700 font-medium mb-6">
                        Control &amp; Instrumentation Maintenance Team Overview
                    </h3>
                    <p class="text-lg text-gray-600 max-w-4xl mx-auto border-b border-egat-yellow pb-4 mb-8">
                        C&amp;I Maintenance Team คือหัวใจสำคัญในการรักษาความมั่นคงของระบบผลิตไฟฟ้า โดยรับผิดชอบดูแลและบำรุงรักษาระบบควบคุมอัตโนมัติ (DCS/PLC) และเครื่องมือวัดค่าทางกายภาพทั้งหมด เพื่อให้โรงไฟฟ้าทำงานด้วยประสิทธิภาพสูงสุดและปลอดภัยตามมาตรฐานสากล
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="p-6 rounded-lg bg-egat-blue/5 border border-egat-blue/20 shadow-md">
                        <svg class="w-8 h-8 mx-auto text-egat-blue mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                        <h4 class="font-semibold text-lg text-gray-800 mb-1">System Stability</h4>
                        <p class="text-sm text-gray-600">รับประกันความต่อเนื่องในการควบคุมกระบวนการผลิตไฟฟ้า</p>
                    </div>
                    <div class="p-6 rounded-lg bg-egat-blue/5 border border-egat-blue/20 shadow-md">
                        <svg class="w-8 h-8 mx-auto text-egat-blue mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                        <h4 class="font-semibold text-lg text-gray-800 mb-1">Maximum Efficiency</h4>
                        <p class="text-sm text-gray-600">การสอบเทียบและบำรุงรักษาเชิงรุกเพื่อลดการสูญเสียพลังงาน</p>
                    </div>
                    <div class="p-6 rounded-lg bg-egat-blue/5 border border-egat-blue/20 shadow-md">
                        <svg class="w-8 h-8 mx-auto text-egat-blue mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                            <path d="M9 12l2 2 4-4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                        <h4 class="font-semibold text-lg text-gray-800 mb-1">Reliability &amp; Safety</h4>
                        <p class="text-sm text-gray-600">ดูแลระบบ SIS และอุปกรณ์ป้องกันอันตรายให้พร้อมใช้งานเสมอ</p>
                    </div>
                </div>
            </div>
        </section>
        <section class="content-section hidden mb-16 opacity-0" id="details">
            <div class="max-w-5xl mx-auto p-8 rounded-xl shadow-2xl bg-white border border-gray-200">
                <h2 class="text-3xl md:text-4xl font-extrabold text-egat-blue mb-2 text-center">
                    Work Details
                </h2>
                <p class="text-lg text-gray-600 max-w-4xl mx-auto border-b border-egat-yellow pb-4 mb-8 text-center">
                    คลิกที่หัวข้อด้านล่างเพื่อดูรายละเอียดเชิงลึกเกี่ยวกับขอบเขตความรับผิดชอบและหน้าที่หลักของทีม C&amp;I
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="intro">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">📝</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Introduction &amp; Organizational Structure</h3>
                        <p class="text-gray-500 text-sm">ทำความรู้จักกับ C&amp;I และบทบาทสำคัญในองค์กร</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="core_work">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">🛠️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Core C&amp;I Functions</h3>
                        <p class="text-gray-500 text-sm">แยกประเภทงานควบคุมและงานเครื่องมือวัด</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="system_overview">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">⚙️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Control &amp; Instrumentation Systems</h3>
                        <p class="text-gray-500 text-sm">ส่วนประกอบและเทคโนโลยีหลักที่ใช้งาน</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="maintenance">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">🔧</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Maintenance and Repair</h3>
                        <p class="text-gray-500 text-sm">แนวทางการบำรุงรักษาและการสอบเทียบ</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="safety">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">🛡️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Safety and Compliance</h3>
                        <p class="text-gray-500 text-sm">มาตรฐานความปลอดภัยและข้อบังคับที่เกี่ยวข้อง</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="future">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">💡</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Technology and Future</h3>
                        <p class="text-gray-500 text-sm">แนวโน้มการเปลี่ยนแปลงและเทคโนโลยีใหม่</p>
                    </div>
                </div>
            </div>
        </section>
        <section class="content-section hidden mb-16 opacity-0" id="training">
            <div class="max-w-5xl mx-auto p-8 rounded-xl shadow-2xl bg-white border border-gray-200">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-egat-blue mb-2">
                        On the Job Training Resources
                    </h2>
                    <p class="text-lg text-gray-600 max-w-4xl mx-auto border-b border-egat-yellow pb-4 mb-8 text-center">
                        นี่คือแหล่งรวมความรู้และเอกสารสำหรับการฝึกอบรมในตำแหน่งงาน C&amp;I
                    </p>
                    <p class="text-lg text-gray-600 max-w-4xl mx-auto">
                        โปรดเลือกหัวข้อย่อยด้านบน (Combined Cycle Power Plant หรือ Solar Power Plant) เพื่อดูรายละเอียด
                    </p>
                </div>
            </div>
        </section>
        <section class="content-section hidden mb-16 opacity-0" id="combined_cycle">
            <div class="max-w-5xl mx-auto p-8 rounded-xl shadow-2xl bg-white border border-gray-200">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-egat-blue mb-2 text-center">
                        Combined Cycle Power Plant
                    </h2>
                    <p class="text-lg text-gray-600 max-w-4xl mx-auto border-b border-egat-yellow pb-4 mb-8 text-center">
                        โรงไฟฟ้าพลังความร้อนร่วมใช้เทคโนโลยีการผลิตไฟฟ้าแบบ 2 วัฏจักร (Cycle) เพื่อเพิ่มประสิทธิภาพในการผลิตไฟฟ้าสูงสุด
                    </p>
                </div>
                <div class="mb-10 p-6 bg-egat-blue/5 rounded-lg border border-egat-blue/10 shadow-md">
                    <h3 class="text-2xl font-bold text-egat-blue mb-3 text-center">Fundamental Principles and Operating Cycles</h3>
                    <p class="text-gray-700 mb-4 text-center">Combined Cycle คือการรวม วัฏจักรเบรย์ตัน (Brayton Cycle) จากกังหันก๊าซ เข้ากับ วัฏจักรแรงคิน (Rankine Cycle) จากกังหันไอน้ำ เพื่อนำความร้อนเหลือทิ้งมาใช้ซ้ำ</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                        <div class="detail-card bg-white p-6 rounded-lg shadow-lg border border-gray-100 cursor-pointer hover:shadow-xl transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_brayton_cycle">
                            <h4 class="font-semibold text-xl text-gray-800 mb-2 flex items-center">
<span class="text-egat-blue text-2xl mr-2 font-extrabold">1.</span> Brayton Cycle (Gas Turbine)
                            </h4>
                            <p class="text-sm text-gray-600 mb-2">เผาไหม้ก๊าซเพื่อขับกังหัน (Gas Turbine) ผลิตไฟฟ้ารอบแรก</p>
                            <p class="text-sm text-egat-blue font-medium">คลิกเพื่อดูบทบาท C&amp;I ในวัฏจักรเบรย์ตัน...</p>
                        </div>
                        <div class="detail-card bg-white p-6 rounded-lg shadow-lg border border-gray-100 cursor-pointer hover:shadow-xl transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_rankine_cycle">
                            <h4 class="font-semibold text-xl text-gray-800 mb-2 flex items-center">
<span class="text-egat-blue text-2xl mr-2 font-extrabold">2.</span> Rankine Cycle (Steam Turbine)
                            </h4>
                            <p class="text-sm text-gray-600 mb-2">นำความร้อนจากไอเสียมาผลิตไอน้ำ (HRSG) ขับกังหันไอน้ำ</p>
                            <p class="text-sm text-egat-blue font-medium">คลิกเพื่อดูบทบาท C&amp;I ในวัฏจักรแรงคิน...</p>
                        </div>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-egat-blue mb-4 text-center border-b border-gray-200 pb-2">In-Depth Details (Click for C&amp;I Role)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="cc_gasturbine">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">🔥</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Gas Turbine (GT) and Combustion</h3>
                        <p class="text-gray-500 text-sm">การควบคุมอุณหภูมิ, เชื้อเพลิง, และระบบป้องกันอันตราย</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="cc_hrsg">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">♨️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">HRSG (Heat Recovery Steam Generator)</h3>
                        <p class="text-gray-500 text-sm">การควบคุมแรงดัน, อุณหภูมิไอน้ำ, และระดับน้ำ</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="cc_steamturbine">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">💧</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Steam Turbine (ST) and Balance of Plant (BOP)</h3>
                        <p class="text-gray-500 text-sm">การควบคุมการทำงานของ ST, คอนเดนเซอร์, และปั๊ม</p>
                    </div>
                </div>
                <div class="mt-12">
                    <h3 class="text-2xl font-bold text-egat-blue mb-4 text-center border-b border-gray-200 pb-2">Central Control Systems</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_dcs">
                            <span class="text-3xl text-egat-blue block mb-1">🖥️</span>
                            <h4 class="font-semibold text-lg text-gray-800">DCS (Distributed Control System)</h4>
                            <p class="text-sm text-gray-600">ควบคุมรวม, แสดงผล, และบริหารจัดการการผลิต</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_bms">
                            <span class="text-3xl text-egat-blue block mb-1">🚨</span>
                            <h4 class="font-semibold text-lg text-gray-800">BMS (Burner Management System)</h4>
                            <p class="text-sm text-gray-600">จัดการการจุดระเบิดและการดับฉุกเฉิน</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_vibration">
                            <span class="text-3xl text-egat-blue block mb-1">⚙️</span>
                            <h4 class="font-semibold text-lg text-gray-800">Vibration Monitoring System</h4>
                            <p class="text-sm text-gray-600">ตรวจวัดและป้องกันความเสียหายจากแรงสั่นสะเทือน</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="cc_cems">
                            <span class="text-3xl text-egat-blue block mb-1">🧪</span>
                            <h4 class="font-semibold text-lg text-gray-800">CEMS (Continuous Emission Monitoring)</h4>
                            <p class="text-sm text-gray-600">ตรวจสอบมลพิษจากปล่องอย่างต่อเนื่อง</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="content-section hidden mb-16 opacity-0" id="solar_power">
            <div class="max-w-5xl mx-auto p-8 rounded-xl shadow-2xl bg-white border border-gray-200">
                <div class="text-center">
                    <h2 class="text-3xl md:text-4xl font-extrabold text-egat-blue mb-2"> 
                        Solar Power Plant
                    </h2>
                    <p class="text-lg text-gray-600 max-w-4xl mx-auto border-b border-egat-yellow pb-4 mb-8 text-center">
                        หน้าที่ของ C&amp;I ในการผลิตและการเชื่อมต่อพลังงานแสงอาทิตย์เข้ากับระบบโครงข่ายไฟฟ้า
                    </p>
                </div>
                <div class="mb-10 p-6 bg-egat-yellow/5 rounded-lg border border-egat-yellow/10 shadow-md">
                    <h3 class="text-2xl font-bold text-egat-blue mb-3 text-center">Fundamental Process and Energy Conversion</h3>
                    <p class="text-gray-700 mb-4 text-center">การผลิตไฟฟ้าพลังงานแสงอาทิตย์ (Solar PV) เกี่ยวข้องกับการแปลงแสงอาทิตย์เป็นไฟฟ้าโดยตรง ตามด้วยการปรับสภาพและประสานเข้ากับระบบโครงข่ายไฟฟ้า</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                        <div class="detail-card bg-white p-6 rounded-lg shadow-lg border border-gray-100 cursor-pointer hover:shadow-xl transition duration-300 hover:ring-2 hover:ring-egat-yellow" data-detail="sp_dc_generation">
                            <h4 class="font-semibold text-xl text-gray-800 mb-2 flex items-center">
<span class="text-egat-blue text-2xl mr-2 font-extrabold">1.</span> DC Generation (PV Array)
                            </h4>
                            <p class="text-sm text-gray-600 mb-2">แผงโซลาร์เซลล์จะรับโฟตอนและสร้างกำลังไฟฟ้ากระแสตรง (DC)</p>
                            <p class="text-sm text-egat-blue font-medium">คลิกเพื่อดูบทบาท C&amp;I ในชุดแผงเซลล์แสงอาทิตย์...</p>
                        </div>
                        <div class="detail-card bg-white p-6 rounded-lg shadow-lg border border-gray-100 cursor-pointer hover:shadow-xl transition duration-300 hover:ring-2 hover:ring-egat-yellow" data-detail="sp_ac_conversion">
                            <h4 class="font-semibold text-xl text-gray-800 mb-2 flex items-center">
<span class="text-egat-blue text-2xl mr-2 font-extrabold">2.</span> AC Conversion (Inverter)
                            </h4>
                            <p class="text-sm text-gray-600 mb-2">กำลังไฟฟ้ากระแสตรง (DC) จะถูกแปลงเป็นไฟฟ้ากระแสสลับ (AC) และซิงโครไนซ์เข้ากับระบบโครงข่ายไฟฟ้า</p>
                            <p class="text-sm text-egat-blue font-medium">คลิกเพื่อดูบทบาท C&amp;I ในอินเวอร์เตอร์...</p>
                        </div>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-egat-blue mb-4 text-center border-b border-gray-200 pb-2">Key C&amp;I Components (Click for Details)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="sp_inverters">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">⚡</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Inverter and MPPT Control</h3>
                        <p class="text-gray-500 text-sm">การควบคุมการแปลงพลังงานและการติดตามจุดกำลังไฟฟ้าสูงสุด</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="sp_weather">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">☁️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Weather Monitoring Station</h3>
                        <p class="text-gray-500 text-sm">การวัดค่าความเข้มแสง อุณหภูมิ และความเร็วลม</p>
                    </div>
                    <div class="detail-card bg-gray-50 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300 cursor-pointer hover:ring-2 hover:ring-egat-blue" data-detail="sp_protection">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-4xl text-egat-blue">🛡️</span>
                        </div>
                        <h3 class="text-xl font-semibold text-egat-blue mb-1">Safety and Grid Protection</h3>
                        <p class="text-gray-500 text-sm">ระบบป้องกันการลัดวงจรและการต่อเข้าระบบโครงข่าย</p>
                    </div>
                </div>
                <div class="mt-12">
                    <h3 class="text-2xl font-bold text-egat-blue mb-4 text-center border-b border-gray-200 pb-2">Control and Monitoring Systems</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center">
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="sp_scada">
                            <span class="text-3xl text-egat-blue block mb-1">🖥️</span>
                            <h4 class="font-semibold text-lg text-gray-800">SCADA/PPC (Plant Controller)</h4>
                            <p class="text-sm text-gray-600">ควบคุมกำลังไฟฟ้าส่งออกและบริหารจัดการโรงไฟฟ้า</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="sp_tracker">
                            <span class="text-3xl text-egat-blue block mb-1">⚙️</span>
                            <h4 class="font-semibold text-lg text-gray-800">Tracking System C&amp;I</h4>
                            <p class="text-sm text-gray-600">การควบคุมมอเตอร์และเซ็นเซอร์ติดตามดวงอาทิตย์</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="sp_dccomps">
                            <span class="text-3xl text-egat-blue block mb-1">🔌</span>
                            <h4 class="font-semibold text-lg text-gray-800">DC Component Monitoring</h4>
                            <p class="text-sm text-gray-600">การวัดกระแส/แรงดัน DC และการตรวจสอบ String/Array</p>
                        </div>
                        <div class="detail-card p-4 rounded-lg bg-gray-50 border border-egat-blue/20 cursor-pointer hover:shadow-md transition duration-300 hover:ring-2 hover:ring-egat-blue" data-detail="sp_ir_temp">
                            <span class="text-3xl text-egat-blue block mb-1">🌡️</span>
                            <h4 class="font-semibold text-lg text-gray-800">IR Temperature Sensing</h4>
                            <p class="text-sm text-gray-600">การเฝ้าระวังความร้อนสูงในจุดเชื่อมต่อและแผง</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="content-section hidden mb-16 opacity-0" id="simulations">

            <body class="p-4 md:p-8 min-h-screen relative">
                <!-- Floating Settings Button (Gear Icon) -->
                <button class="p-2 bg-gray-700 hover:bg-blue-500 text-blue-300 hover:text-white rounded-full transition duration-200 shadow-lg" id="settingsGearButton">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.568.32 1.32.32 1.888 0 1.543-.94 3.31-.826 2.37-2.37a1.724 1.724 0 00-1.065-2.572zM12 12a3 3 0 100-6 3 3 0 000 6z"
                        stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                </button>
                <div class="max-w-4xl mx-auto">
                    <!-- API Key Input Section (Initially hidden if key is present) -->
                    <div class="bg-[#2C3E50] p-5 rounded-xl shadow-lg mb-6 border border-[#5DADE2]" id="apiKeySection">
                        <h2 class="text-xl font-semibold mb-3 text-white flex items-center">
                🔑 Gemini API Key Setup
            </h2>
                        <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3 items-end">
                            <div class="flex-grow w-full">
                                <label class="block text-sm font-medium text-gray-300 mb-1" for="apiKeyInput">
                                    โปรดใส่ Gemini API Key ของคุณ:
                                </label>
                                <input class="w-full px-4 py-2 border border-gray-600 rounded-lg bg-[#34495E] text-white focus:ring-blue-400 focus:border-blue-400 transition duration-150" id="apiKeyInput" placeholder="PASTE_YOUR_GEMINI_API_KEY_HERE" type="password" />
                            </div>
                            <button class="px-5 py-2 bg-[#3498DB] hover:bg-[#5DADE2] text-white font-bold rounded-lg transition duration-200 w-full md:w-auto shadow-md" id="saveApiKeyButton">
                                บันทึก/อัปเดต
                            </button>
                        </div>
                        <p class="mt-2 text-sm font-medium text-gray-400" id="apiKeyStatus"></p>
                    </div>
                    <!-- End API Key Input Section -->
                    <!-- Header -->
                    <header class="text-center mb-10 mt-10 md:mt-0">
                        <h1 class="text-4xl font-extrabold text-[#5DADE2] mb-2">ที่ปรึกษาปฏิบัติการโรงไฟฟ้า CCPP</h1>
                        <p class="text-lg text-gray-400 flex justify-center items-center">
                            โปรแกรมจำลองการวิเคราะห์การเดินเครื่องและเหตุขัดข้อง
                            <span id="modelBadge">Model: gemini-2.0-flash</span>
                        </p>
                    </header>
                    <!-- Main Action Button -->
                    <div class="flex justify-center mb-10">
                        <button class="px-8 py-3 bg-[#3498DB] hover:bg-[#5DADE2] text-white font-bold rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-300 focus:ring-opacity-50 flex items-center disabled:opacity-50 disabled:cursor-not-allowed"
                        id="generateButton">
                            <svg class="h-6 w-6 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            สร้างสถานการณ์ขัดข้องใหม่
                        </button>
                    </div>
                    <!-- Loading/Error Indicator -->
                    <div class="text-center text-lg mb-6 h-6" id="statusArea"></div>
                    <!-- Scenario Container -->
                    <div class="space-y-6" id="scenarioContainer">
                        <!-- SCENARIO TITLE & GRADE LEVEL (Hidden initially, shown when RCA is opened) -->
                        <div class="hidden fade-in space-y-2 pb-2" id="spoilerHeaders">
                            <h2 class="text-3xl font-bold text-[#5DADE2]" id="scenarioTitle"></h2>
                            <p class="text-sm font-medium text-gray-400" id="gradeLevel"></p>
                        </div>
                        <!-- 1. Event Description (NOW an Accordion) -->
                        <div class="accordion-item rounded-xl shadow-xl">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left bg-[#2C3E50] hover:bg-[#34495E] rounded-xl transition duration-200" data-target="eventDescriptionContent">
                                <h3 class="text-xl font-semibold text-[#5DADE2]">🚨 Event Description (รายละเอียดเหตุการณ์)</h3>
                                <svg class="h-6 w-6 text-[#5DADE2] transform transition-transform duration-300" data-arrow="eventDescriptionContent" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </button>
                            <div class="collapsible-content hidden-content" id="eventDescriptionContent">
                                <div class="accordion-content-body p-6 rounded-b-xl border-t-0">
                                    <p class="whitespace-pre-wrap text-gray-300" id="eventDescriptionText">โปรดใส่ API Key และกดปุ่ม "สร้างสถานการณ์ขัดข้องใหม่" เพื่อเริ่มการจำลอง</p>
                                </div>
                            </div>
                        </div>
                        <!-- 2. Root Cause Analysis (RCA) - Accordion -->
                        <div class="accordion-item rounded-xl shadow-xl">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left bg-[#2C3E50] hover:bg-[#34495E] rounded-xl transition duration-200" data-is-spoiler="true" data-target="rootCauseContent">
                                <h3 class="text-xl font-semibold text-[#5DADE2]">🔍 Root Cause Analysis (RCA)</h3>
                                <svg class="h-6 w-6 text-[#5DADE2] transform transition-transform duration-300" data-arrow="rootCauseContent" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </button>
                            <div class="collapsible-content hidden-content" id="rootCauseContent">
                                <div class="accordion-content-body p-6 rounded-b-xl border-t-0">
                                    <p class="whitespace-pre-wrap text-gray-300" id="rootCauseText"></p>
                                </div>
                            </div>
                        </div>
                        <!-- 3. Immediate Solution - Accordion -->
                        <div class="accordion-item rounded-xl shadow-xl">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left bg-[#2C3E50] hover:bg-[#34495E] rounded-xl transition duration-200" data-target="solutionContent">
                                <h3 class="text-xl font-semibold text-[#5DADE2]">✅ Immediate Solution (วิธีแก้ไขเบื้องต้น)</h3>
                                <svg class="h-6 w-6 text-[#5DADE2] transform transition-transform duration-300" data-arrow="solutionContent" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </button>
                            <div class="collapsible-content hidden-content" id="solutionContent">
                                <div class="accordion-content-body p-6 rounded-b-xl border-t-0">
                                    <p class="whitespace-pre-wrap text-gray-300" id="immediateSolutionText"></p>
                                </div>
                            </div>
                        </div>
                        <!-- 4. Preventative Measures - Accordion -->
                        <div class="accordion-item rounded-xl shadow-xl">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left bg-[#2C3E50] hover:bg-[#34495E] rounded-xl transition duration-200" data-target="precautionsContent">
                                <h3 class="text-xl font-semibold text-[#5DADE2]">🛡️ Preventative Measures (มาตรการป้องกัน)</h3>
                                <svg class="h-6 w-6 text-[#5DADE2] transform transition-transform duration-300" data-arrow="precautionsContent" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                    <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </button>
                            <div class="collapsible-content hidden-content" id="precautionsContent">
                                <div class="accordion-content-body p-6 rounded-b-xl border-t-0">
                                    <p class="whitespace-pre-wrap text-gray-300" id="preventativeMeasuresText"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    // --- CONFIGURATION ---
                    const GEMINI_MODEL = "gemini-2.0-flash"; 
                    const MAX_RETRIES = 5;
            
                    // --- DOM ELEMENTS ---
                    const generateButton = document.getElementById('generateButton');
                    const statusArea = document.getElementById('statusArea');
                    const apiKeySection = document.getElementById('apiKeySection'); 
                    const settingsGearButton = document.getElementById('settingsGearButton'); 
            
                    const spoilerHeaders = document.getElementById('spoilerHeaders');
                    const scenarioTitle = document.getElementById('scenarioTitle');
                    const gradeLevel = document.getElementById('gradeLevel');
            
                    const eventDescriptionText = document.getElementById('eventDescriptionText');
                    const rootCauseText = document.getElementById('rootCauseText');
                    const immediateSolutionText = document.getElementById('immediateSolutionText');
                    const preventativeMeasuresText = document.getElementById('preventativeMeasuresText');
                    
                    const apiKeyInput = document.getElementById('apiKeyInput');
                    const saveApiKeyButton = document.getElementById('saveApiKeyButton');
                    const apiKeyStatus = document.getElementById('apiKeyStatus');
                    const modelBadge = document.getElementById('modelBadge');
            
                    let userApiKey = ""; 
                    let accordionHeaders; 
            
                    // --- API & SYSTEM PROMPTS ---
                    const responseSchema = {
                        type: "OBJECT",
                        properties: {
                            "scenarioTitle": { "type": "STRING", "description": "A concise title for the event. (English only)" },
                            "gradeLevel": { "type": "STRING", "description": "Inferred expertise level (e.g., Junior Engineer, Senior Advisor)." },
                            "eventDescription": { "type": "STRING", "description": "The detailed narrative of the trip or failure." },
                            "rootCauseAnalysis": { "type": "STRING", "description": "Detailed explanation of the component failure, physics, or sequence leading to the trip/failure." },
                            "immediateSolution": { "type": "STRING", "description": "The required immediate steps to resolve the issue and safely restore the unit." },
                            "preventativeMeasures": { "type": "STRING", "description": "Long-term procedures, maintenance changes, or design modifications to prevent recurrence." }
                        },
                        required: ["scenarioTitle", "gradeLevel", "eventDescription", "rootCauseAnalysis", "immediateSolution", "preventativeMeasures"]
                    };
            
                    const systemPrompt = `คุณคือวิศวกรปฏิบัติการและที่ปรึกษาการเดินเครื่องโรงไฟฟ้าพลังงานความร้อนร่วม (CCPP) ที่มีประสบการณ์สูง หน้าที่ของคุณคือสร้างสถานการณ์ขัดข้องหรือการเดินเครื่องล้มเหลวที่สมจริงและซับซ้อน พร้อมการวิเคราะห์อย่างมืออาชีพตามมาตรฐานทางวิศวกรรมการเดินเครื่องโรงไฟฟ้า โดยเนื้อหาทั้งหมดใน JSON ต้องเป็นภาษาไทยและใช้ภาษาทางการเหมือนรายงานทางวิศวกรรมอย่างเคร่งครัด ยกเว้นเนื้อหาส่วน 'scenarioTitle' เท่านั้นที่ต้องเป็นภาษาอังกฤษ ส่วน 'eventDescription' และส่วนอื่นๆ เป็นภาษาไทย การวัดทางเทคนิคทั้งหมด (อุณหภูมิ, ความดัน, อัตราการไหล, กำลังไฟฟ้า) ต้องใช้หน่วยเมตริก (Metric system) หรือหน่วย SI เท่านั้น เช่น องศาเซลเซียส (°C), บาร์ (bar) หรือ kPa, เมกะวัตต์ (MW) และ กิโลกรัมต่อวินาที (kg/s) **ในทุกส่วนของรายงาน (eventDescription, rootCauseAnalysis, immediateSolution, preventativeMeasures) ให้ใช้การขึ้นบรรทัดใหม่ (newline characters) และการเว้นวรรคย่อหน้า/การทำรายการอย่างชัดเจน เพื่อให้อ่านง่ายและสบายตา**`;
            
                    // --- UTILITY FUNCTIONS ---
            
                    /**
                     * Utility to implement exponential backoff retry logic for fetch.
                     */
                    async function fetchWithRetry(url, options, maxRetries = MAX_RETRIES) {
                        for (let attempt = 0; attempt < maxRetries; attempt++) {
                            try {
                                const response = await fetch(url, options);
                                if (response.ok) {
                                    return response;
                                }
            
                                const errorBody = await response.text(); 
                                let parsedErrorBody = {};
                                try {
                                    parsedErrorBody = JSON.parse(errorBody);
                                } catch (e) {
                                    // Ignore JSON parsing errors if body is not JSON
                                }
            
                                // Retry on server errors or transient issues (5xx, 429)
                                if (response.status >= 500 || response.status === 429) {
                                    if (parsedErrorBody.error && parsedErrorBody.error.message && parsedErrorBody.error.message.includes("Model is overloaded")) {
                                        console.error(`[Attempt ${attempt + 1}/${maxRetries}] Specific API Error 503: Model is overloaded.`, parsedErrorBody);
                                    } else {
                                        console.warn(`[Attempt ${attempt + 1}/${maxRetries}] API error ${response.status}. Retrying...`);
                                    }
                                    
                                    if (attempt < maxRetries - 1) {
                                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                                        await new Promise(resolve => setTimeout(resolve, delay));
                                        continue;
                                    }
                                }
                                
                                // For client errors (4xx) or maxed retries, throw error
                                throw new Error(`API request failed with status ${response.status}: ${response.statusText}. Response: ${errorBody}`);
            
                            } catch (error) {
                                if (attempt < maxRetries - 1) {
                                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                                    console.error(`[Attempt ${attempt + 1}/${maxRetries}] Fetch error: ${error.message}. Retrying in ${delay / 1000}s...`);
                                    await new Promise(resolve => setTimeout(resolve, delay));
                                    continue;
                                }
                                console.error("Exhausted retries due to persistent network/fetch error or final API error:", error); 
                                throw new Error(error.message || "Failed to fetch data after multiple retries.");
                            }
                        }
                        throw new Error("Failed to fetch data after multiple retries.");
                    }
                    
                    // --- API SECTION MANAGEMENT ---
                    
                    function showApiKeySection() {
                        apiKeySection.classList.remove('hidden-content');
                    }
            
                    function hideApiKeySection() {
                         apiKeySection.classList.add('hidden-content');
                    }
            
                    /**
                     * Loads API Key from local storage and updates the input field.
                     */
                    function loadApiKey() {
                        const storedKey = localStorage.getItem('geminiApiKey');
                        if (storedKey) {
                            userApiKey = storedKey;
                            apiKeyInput.value = storedKey;
                            apiKeyStatus.textContent = "API Key โหลดจาก Local Storage สำเร็จ.";
                            apiKeyStatus.classList.remove('text-red-600', 'text-amber-600');
                            apiKeyStatus.classList.add('text-green-500'); /* Changed to green-500 */
                            
                            generateButton.disabled = false;
                            generateButton.classList.remove('opacity-50', 'cursor-not-allowed');
                            
                            hideApiKeySection(); 
            
                            return true;
                        } else {
                            userApiKey = "";
                            apiKeyInput.value = "";
                            apiKeyStatus.textContent = "โปรดใส่ API Key เพื่อเริ่มใช้งาน.";
                            apiKeyStatus.classList.remove('text-green-500', 'text-red-600');
                            apiKeyStatus.classList.add('text-amber-500'); /* Changed to amber-500 */
                            
                            generateButton.disabled = true;
                            generateButton.classList.add('opacity-50', 'cursor-not-allowed');
                            
                            showApiKeySection(); 
            
                            return false;
                        }
                    }
            
                    /**
                     * Saves API Key to local storage.
                     */
                    function saveApiKey() {
                        const key = apiKeyInput.value.trim();
                        if (key) {
                            userApiKey = key;
                            localStorage.setItem('geminiApiKey', key);
                            apiKeyStatus.textContent = "API Key บันทึกสำเร็จแล้ว! พร้อมใช้งาน";
                            apiKeyStatus.classList.remove('text-red-600', 'text-amber-500');
                            apiKeyStatus.classList.add('text-green-500'); 
                            
                            generateButton.disabled = false;
                            generateButton.classList.remove('opacity-50', 'cursor-not-allowed');
                            
                            hideApiKeySection(); 
            
                        } else {
                            userApiKey = "";
                            localStorage.removeItem('geminiApiKey');
                            apiKeyStatus.textContent = "API Key ถูกล้างแล้ว โปรดใส่คีย์ใหม่.";
                            apiKeyStatus.classList.remove('text-green-500', 'text-amber-500');
                            apiKeyStatus.classList.add('text-red-600'); 
                            
                            generateButton.disabled = true; 
                            generateButton.classList.add('opacity-50', 'cursor-not-allowed');
                            
                            showApiKeySection(); 
                        }
                        
                        // Update initial status after saving/clearing key
                        if (userApiKey) {
                             statusArea.textContent = "พร้อม! กดปุ่ม 'สร้างสถานการณ์ขัดข้องใหม่' เพื่อเริ่มจำลอง.";
                             statusArea.classList.remove('text-red-600', 'text-amber-500');
                             statusArea.classList.add('text-green-500');
                        } else {
                             statusArea.textContent = "โปรดใส่ API Key ด้านบนเพื่อสร้างสถานการณ์";
                             statusArea.classList.remove('text-green-500', 'text-red-600');
                             statusArea.classList.add('text-amber-500');
                        }
                    }
            
            
                    // --- UI MANAGEMENT ---
            
                    /**
                     * Hides all results sections and resets the accordion state.
                     */
                    function hideResults() {
                        spoilerHeaders.classList.add('hidden');
                        
                        // Collapse all accordions and reset arrow
                        document.querySelectorAll('.accordion-header').forEach(header => {
                            const targetId = header.getAttribute('data-target');
                            const content = document.getElementById(targetId);
                            const arrow = document.querySelector(`[data-arrow="${targetId}"]`);
            
                            if (content.classList.contains('expanded')) {
                                content.classList.remove('expanded');
                            }
                            if (arrow.classList.contains('rotate-180')) {
                                arrow.classList.remove('rotate-180');
                            }
                            
                            // Set initial border-radius to ensure rounded corners on all items
                            header.classList.add('rounded-xl');
                            header.classList.remove('rounded-t-xl');
                        });
                        
                        // Clear content
                        scenarioTitle.textContent = '';
                        gradeLevel.textContent = '';
                        rootCauseText.textContent = '';
                        immediateSolutionText.textContent = '';
                        preventativeMeasuresText.textContent = '';
                        // Only update the main description text placeholder
                        eventDescriptionText.textContent = 'กำลังรอสร้างสถานการณ์...';
                    }
            
                    /**
                     * Shows the loading indicator.
                     */
                    function showLoading() {
                        generateButton.disabled = true;
                        statusArea.innerHTML = '<span class="loading-ring mr-2"></span> กำลังสร้างสถานการณ์ที่ซับซ้อน...';
                        statusArea.classList.remove('text-red-600', 'text-green-500');
                        statusArea.classList.add('text-blue-400'); /* Use blue-400 for loading status on dark BG */
                        eventDescriptionText.textContent = '...กำลังโหลดข้อมูล...';
                    }
            
                    /**
                     * Shows an error message with specific handling for API errors.
                     */
                    function showError(message) {
                        generateButton.disabled = false;
                        let displayMessage = message;
                        
                        if (message.includes("Model is overloaded")) {
                            displayMessage = "โมเดลมีภาระงานมากเกินไป (503 Service Unavailable) โปรดรอ 2-3 นาที แล้วลองใหม่อีกครั้ง";
                        } else if (message.includes("status 401") || message.includes("status 400") || message.includes("API key not valid")) {
                            displayMessage = "API Key ไม่ถูกต้อง (401/400) โปรดตรวจสอบและใส่คีย์ที่ถูกต้อง หรือลองใช้คีย์ใหม่";
                        } else if (message.includes("status 403")) {
                            displayMessage = "การเข้าถึงถูกปฏิเสธ (403) ตรวจสอบสิทธิ์, การตั้งค่า Billing, หรือโควต้าของ API Key";
                        } else if (message.includes("Failed to fetch data after multiple retries")) {
                            displayMessage = "เกิดข้อผิดพลาดในการเชื่อมต่อ (Network/Transient Failure) ลองใหม่อีกครั้ง";
                        }
                        
                        statusArea.textContent = `ข้อผิดพลาด: ${displayMessage}`;
                        statusArea.classList.remove('text-blue-400', 'text-green-500');
                        statusArea.classList.add('text-red-600');
                        eventDescriptionText.textContent = 'ไม่สามารถสร้างสถานการณ์ได้';
                    }
            
                    /**
                     * Toggles the visibility of an accordion content section.
                     * @param {HTMLElement} header - The clicked accordion header button.
                     */
                    function toggleAccordion(header) {
                        // Check if the scenario has been generated (prevent spoiler click on empty data)
                        if (!scenarioTitle.textContent && header.getAttribute('data-target') !== 'eventDescriptionContent') {
                            return;
                        }
                    
                        const targetId = header.getAttribute('data-target');
                        const content = document.getElementById(targetId);
                        const arrow = document.querySelector(`[data-arrow="${targetId}"]`);
            
                        const isExpanded = content.classList.contains('expanded');
                        
                        // 1. Close all other accordions (Keep the one being clicked open if it was closed)
                        document.querySelectorAll('.collapsible-content.expanded').forEach(expandedContent => {
                            // Collapse only if it's not the one we are about to expand or if we are clicking to collapse the current one
                            if (expandedContent.id !== targetId || isExpanded) {
                                expandedContent.classList.remove('expanded');
                                document.querySelector(`[data-target="${expandedContent.id}"]`).classList.add('rounded-xl');
                                document.querySelector(`[data-target="${expandedContent.id}"]`).classList.remove('rounded-t-xl');
                                document.querySelector(`[data-arrow="${expandedContent.id}"]`).classList.remove('rotate-180');
                            }
                        });
            
                        // 2. Toggle the current one if it was not already collapsed in step 1 (i.e., if we clicked to expand it)
                        if (!isExpanded) {
                            content.classList.add('expanded');
                            arrow.classList.add('rotate-180');
                            header.classList.remove('rounded-xl');
                            header.classList.add('rounded-t-xl');
            
                            // If this is the RCA (spoiler), reveal the Scenario Title and Grade Level
                            if (header.getAttribute('data-is-spoiler') === 'true') {
                                spoilerHeaders.classList.remove('hidden');
                                spoilerHeaders.classList.add('fade-in');
                            }
                        }
                    }
            
                    /**
                     * Displays the generated scenario data in the UI and expands the Event Description.
                     */
                    function displayScenario(data) {
                        // Update Text Content
                        scenarioTitle.textContent = data.scenarioTitle;
                        gradeLevel.textContent = `ระดับความท้าทาย: ${data.gradeLevel}`;
                        eventDescriptionText.textContent = data.eventDescription;
                        rootCauseText.textContent = data.rootCauseAnalysis;
                        immediateSolutionText.textContent = data.immediateSolution;
                        preventativeMeasuresText.textContent = data.preventativeMeasures;
            
                        // Update Status
                        statusArea.textContent = "สร้างสถานการณ์สำเร็จ! ลองอ่านรายละเอียดเหตุการณ์และเริ่มวิเคราะห์คำตอบด้วยตัวคุณเอง";
                        statusArea.classList.remove('text-red-600', 'text-blue-400');
                        statusArea.classList.add('text-green-500');
                        
                        generateButton.disabled = false;
                        
                        // Explicitly expand the Event Description accordion upon success
                        const eventHeader = document.querySelector('[data-target="eventDescriptionContent"]');
                        if (eventHeader) {
                             // Close all first
                             document.querySelectorAll('.collapsible-content.expanded').forEach(expandedContent => {
                                expandedContent.classList.remove('expanded');
                                document.querySelector(`[data-target="${expandedContent.id}"]`).classList.add('rounded-xl');
                                document.querySelector(`[data-target="${expandedContent.id}"]`).classList.remove('rounded-t-xl');
                                document.querySelector(`[data-arrow="${expandedContent.id}"]`).classList.remove('rotate-180');
                             });
            
                             // Then open the event description
                             toggleAccordion(eventHeader);
                        }
                    }
            
            
                    // --- MAIN LOGIC ---
            
                    /**
                     * Handles the API call and scenario generation.
                     */
                    async function generateScenario() {
                        if (!userApiKey) {
                            statusArea.textContent = "โปรดใส่ Gemini API Key ก่อนเริ่มสร้างสถานการณ์.";
                            statusArea.classList.remove('text-blue-400', 'text-green-500');
                            statusArea.classList.add('text-red-600');
                            showApiKeySection();
                            return;
                        }
            
                        hideResults();
                        showLoading();
                        
                        const userQuery = "Generate a new, unique scenario for a Combined Cycle Power Plant failure or startup abort, including the full root cause analysis, immediate solution, and long-term preventative measures. Ensure all output is in a professional Thai engineering report format.";
            
                        const payload = {
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: {
                                responseMimeType: "application/json",
                                responseSchema: responseSchema
                            }
                        };
                        
                        const dynamicApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${userApiKey}`;
            
            
                        try {
                            const response = await fetchWithRetry(dynamicApiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });
                            
                            const result = await response.json();
            
                            if (result.error && result.error.message) {
                                throw new Error(result.error.message);
                            }
            
                            const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                            if (!jsonText) {
                                throw new Error("API returned no content or an unexpected JSON structure.");
                            }
            
                            const scenarioData = JSON.parse(jsonText);
                            displayScenario(scenarioData);
            
                        } catch (error) {
                            console.error("Scenario generation failed:", error);
                            showError(error.message); 
                        }
                    }
            
            
                    // --- INITIALIZATION ---
            
                    // Event Listeners
                    generateButton.addEventListener('click', generateScenario);
                    saveApiKeyButton.addEventListener('click', saveApiKey);
                    
                    // Settings Gear Button Listener
                    settingsGearButton.addEventListener('click', () => {
                         // Toggle visibility of the API section
                         if (apiKeySection.classList.contains('hidden-content')) {
                             showApiKeySection();
                         } else {
                             // If the key is valid, hide it on toggle click
                             if (userApiKey) {
                                hideApiKeySection();
                             }
                         }
                    });
                    
                    window.onload = () => {
                         // Initialize accordion headers after DOM load
                         accordionHeaders = document.querySelectorAll('.accordion-header');
                         // Attach click listener to all accordion headers
                         accordionHeaders.forEach(header => {
                            header.addEventListener('click', () => toggleAccordion(header));
                         });
            
                         // Update model badge display
                         modelBadge.textContent = `Model: ${GEMINI_MODEL}`;
                         
                         // 1. Load key first (this handles hiding/showing the section based on key presence)
                         const keyLoaded = loadApiKey(); 
            
                         // 2. Set initial status based on key presence
                         if (!keyLoaded) {
                             statusArea.textContent = "โปรดใส่ API Key ด้านบนเพื่อสร้างสถานการณ์";
                             statusArea.classList.remove('text-blue-400', 'text-green-500', 'text-red-600');
                             statusArea.classList.add('text-amber-500');
                         } else {
                             statusArea.textContent = "API Key พร้อมใช้งาน! กดปุ่ม 'สร้างสถานการณ์ขัดข้องใหม่' เพื่อเริ่มจำลอง.";
                             statusArea.classList.remove('text-blue-400', 'text-red-600', 'text-amber-500');
                             statusArea.classList.add('text-green-500');
                         }
                    };
                </script>
            </body>
        </section>
    </main>
    <div class="hidden fixed inset-0 z-40" id="modal">
        <div class="fixed inset-0 bg-gray-900 modal-backdrop-transition opacity-0" id="modal-backdrop"></div>
        <div class="fixed inset-0 flex items-center justify-center p-4 modal-content-transition scale-95 opacity-0" id="modal-content-box">
            <div class="modal-content bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto relative p-8">
                <h3 class="text-3xl font-bold text-egat-blue mb-4 border-b pb-2" id="modal-title"></h3>
                <div class="text-gray-700 space-y-4" id="modal-body">
                </div>
                <button class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 transition duration-300" onclick="closeModal()">
                    <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18"></path>
                        <path d="M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <div class="hidden">
        <div id="detail-content-intro">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Introduction and Organizational Structure</h3>
            <span class="hidden" id="detail-topic-intro">Organizational Structure and Key Responsibilities of C&amp;I Team in Power Plant</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Background and Evolution</h4>
                <p class="text-gray-600">งาน C&amp;I เริ่มต้นขึ้นพร้อมกับการพัฒนาโรงไฟฟ้าของ กฟผ. โดยมีวิวัฒนาการจากการควบคุมแบบอะนาล็อกไปสู่ระบบดิจิทัลที่ซับซ้อนในปัจจุบัน</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Mission and Significance</h4>
                <p class="text-gray-600">มุ่งเน้นการบำรุงรักษาระบบควบคุมและเครื่องมือวัดให้อยู่ในสภาพพร้อมใช้งานสูงสุด เพื่อสนับสนุนการผลิตไฟฟ้าที่มั่นคงและมีประสิทธิภาพ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">C&amp;I Team Structure</h4>
                <p class="text-gray-600">แบ่งออกเป็นหน่วยงานย่อยตามลักษณะของระบบ เช่น ระบบควบคุมหลัก (DCS), ระบบความปลอดภัย, และงานสอบเทียบเครื่องมือวัด</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Team Responsibilities</h4>
                <ul class="list-disc pl-5 space-y-1 text-gray-600">
                    <li>วางแผนและดำเนินการบำรุงรักษาเชิงป้องกัน (PM)</li>
                    <li>วิเคราะห์และแก้ไขปัญหาที่เกิดขึ้นกับระบบควบคุม</li>
                    <li>บริหารจัดการอะไหล่และเอกสารทางเทคนิค</li>
                </ul>
            </section>
        </div>
        <div id="detail-content-core_work">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Core C&amp;I Functions</h3>
            <span class="hidden" id="detail-topic-core_work">DCS and PLC maintenance in power generation.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Primary Control Systems (DCS/PLC)</h4>
                <p class="text-gray-600">การดูแลรักษาและปรับปรุงระบบควบคุมอัตโนมัติ เช่น DCS (Distributed Control System) และ PLC (Programmable Logic Controller) เพื่อควบคุมกระบวนการผลิตไฟฟ้า</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Instrumentation and Sensors</h4>
                <p class="text-gray-600">การติดตั้ง บำรุงรักษา และสอบเทียบเครื่องมือวัดต่างๆ เช่น เครื่องวัดอุณหภูมิ ความดัน อัตราการไหล และระดับ เพื่อให้การวัดค่ามีความแม่นยำ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Specialized Work and Technology</h4>
                <p class="text-gray-600">รวมถึงงานที่เกี่ยวข้องกับระบบความปลอดภัย (Safety Instrumented Systems - SIS), ระบบตรวจจับเพลิงไหม้ (Fire and Gas), และระบบควบคุมกังหัน (Turbine Control Systems)</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Technical Documentation Management</h4>
                <p class="text-gray-600">การจัดทำ จัดเก็บ และปรับปรุงแบบแปลน (Drawings), คู่มือ (Manuals), และประวัติการซ่อมบำรุง (Maintenance Records) เพื่อให้พร้อมสำหรับการอ้างอิงและตรวจสอบ</p>
            </section>
        </div>
        <div id="detail-content-system_overview">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Control and Instrumentation Systems</h3>
            <span class="hidden" id="detail-topic-system_overview">Power Plant Control Systems (DCS/PLC, Sensors, and Safety Systems)</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Primary Control Systems (DCS/PLC)</h4>
                <p class="text-gray-600">เป็นหัวใจสำคัญในการสั่งการและควบคุมการทำงานของอุปกรณ์ในโรงไฟฟ้า โดยมีสถาปัตยกรรมแบบกระจายศูนย์ (Distributed Architecture)</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Sensors and Transducers</h4>
                <p class="text-gray-600">อุปกรณ์ที่แปลงค่าทางกายภาพ (เช่น ความร้อน, แรงดัน) ให้เป็นสัญญาณไฟฟ้า เพื่อส่งไปยังระบบควบคุม</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Safety Systems</h4>
                <p class="text-gray-600">ระบบที่ออกแบบมาเพื่อป้องกันความเสียหายต่ออุปกรณ์ บุคลากร และสิ่งแวดล้อม เช่น ระบบ ESD (Emergency Shutdown)</p>
            </section>
        </div>
        <div id="detail-content-maintenance">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Maintenance and Repair</h3>
            <span class="hidden" id="detail-topic-maintenance">Preventive and Corrective Maintenance for C&amp;I systems including calibration standards</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Preventive Maintenance (PM)</h4>
                <p class="text-gray-600">การดำเนินการตามแผนเพื่อป้องกันความล้มเหลวของอุปกรณ์ เช่น การเปลี่ยนแบตเตอรี่, การทำความสะอาดตู้ควบคุม, และการตรวจสอบสายสัญญาณ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Corrective Maintenance (CM)</h4>
                <p class="text-gray-600">การซ่อมแซมทันทีเมื่อเกิดความผิดปกติหรือความล้มเหลวของระบบ เพื่อให้ระบบกลับมาทำงานได้ตามปกติ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Calibration and Standards</h4>
                <p class="text-gray-600">การสอบเทียบเครื่องมือวัดตามมาตรฐานสากล (เช่น ISO/IEC 17025) และการเก็บบันทึกประวัติการสอบเทียบอย่างเป็นระบบ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Spares and Tool Management</h4>
                <p class="text-gray-600">การสำรองอะไหล่สำคัญ (Critical Spares) อย่างเหมาะสม และการดูแลรักษาเครื่องมือสอบเทียบและเครื่องมือเฉพาะทางให้อยู่ในสภาพพร้อมใช้งาน</p>
            </section>
        </div>
        <div id="detail-content-safety">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Safety and Compliance</h3>
            <span class="hidden" id="detail-topic-safety">Safety standards, compliance, and risk management for C&amp;I systems (e.g., IEC 61511)</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Standards and Regulations</h4>
                <p class="text-gray-600">การปฏิบัติตามมาตรฐาน IEC 61511 (Safety Instrumented Systems) และข้อกำหนดอื่นๆ ที่เกี่ยวข้องกับการทำงานในพื้นที่เสี่ยง (Hazardous Areas)</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Training and Certification</h4>
                <p class="text-gray-600">บุคลากร C&amp;I ต้องได้รับการฝึกอบรมเฉพาะทางด้านเทคนิค ความปลอดภัย และการทำงานกับระบบไฟฟ้า/ควบคุมแรงดันสูง</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">C&amp;I Risk Management</h4>
                <p class="text-gray-600">การประเมินความเสี่ยงและวางแผนบรรเทาความเสี่ยงที่เกี่ยวข้องกับการทำงานผิดพลาดของระบบควบคุมซึ่งอาจส่งผลกระทบต่อการผลิตและความปลอดภัย</p>
            </section>
        </div>
        <div id="detail-content-future">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Technology and Future</h3>
            <span class="hidden" id="detail-topic-future">Digital Transformation, Cybersecurity, and future trends in C&amp;I maintenance</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Digital Transformation and Industry 4.0</h4>
                <p class="text-gray-600">การนำเทคโนโลยี IoT, Cloud Computing และ AI มาใช้ในการวิเคราะห์ข้อมูลการทำงานของ C&amp;I เพื่อการบำรุงรักษาเชิงคาดการณ์ (Predictive Maintenance)</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Cybersecurity</h4>
                <p class="text-gray-600">การป้องกันระบบควบคุมอุตสาหกรรม (ICS) จากภัยคุกคามทางไซเบอร์ ซึ่งเป็นสิ่งสำคัญอย่างยิ่งในยุคดิจิทัล</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Future Trends</h4>
                <p class="text-gray-600">การเปลี่ยนไปใช้เครื่องมือวัดไร้สาย (Wireless Instrumentation) และการบูรณาการระบบควบคุมจากผู้ผลิตที่หลากหลาย (Vendor Neutral Systems)</p>
            </section>
        </div>
        <div id="detail-content-cc_brayton_cycle">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">C&amp;I Role in Brayton Cycle (Gas Turbine)</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Fuel-Air Ratio Control</h4>
                <p class="text-gray-600">ควบคุมอัตราส่วนเชื้อเพลิงต่ออากาศ (Air/Fuel Ratio) และการทำงานของวาล์วเชื้อเพลิงเพื่อให้การเผาไหม้สมบูรณ์และลดมลพิษ (NOx)</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Temperature and Vibration Monitoring</h4>
                <p class="text-gray-600">เฝ้าระวังอุณหภูมิก๊าซไอเสีย (Exhaust Gas Temperature - EGT) และการสั่นสะเทือนของกังหันเพื่อป้องกันความเสียหาย</p>
            </section>
        </div>
        <div id="detail-content-cc_rankine_cycle">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">C&amp;I Role in Rankine Cycle (Steam Turbine)</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Steam Parameters Control</h4>
                <p class="text-gray-600">ควบคุมระดับน้ำในหม้อไอน้ำ (Drum Level Control), อุณหภูมิไอน้ำ (Superheater Temperature Control), และแรงดันไอน้ำ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Protection and Governor Systems</h4>
                <p class="text-gray-600">ดูแลระบบป้องกันการเร่งความเร็วเกิน (Overspeed Protection), ระบบวาล์วไอน้ำเข้า (Stop &amp; Governor Valves), และระบบแบริ่ง</p>
            </section>
        </div>
        <div id="detail-content-cc_gasturbine">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Gas Turbine (GT) and Combustion</h3>
            <span class="hidden" id="detail-topic-cc_gasturbine">Gas Turbine and Combustion control systems in combined cycle power plants</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">GT Principles and Cycle</h4>
                <p class="text-gray-600">อากาศถูกอัดโดยคอมเพรสเซอร์ (Compressor) ผสมกับเชื้อเพลิงในห้องเผาไหม้ (Combustion Chamber) และก๊าซร้อนที่ได้จะขับเคลื่อนกังหัน (Turbine) เพื่อผลิตไฟฟ้าตามวัฏจักร Brayton การควบคุมอุณหภูมิที่เข้าสู่กังหันเป็นสิ่งสำคัญที่สุด</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">C&amp;I Functions</h4>
                <p class="text-gray-600">ติดตั้งและบำรุงรักษา: Flame Detectors, Thermocouples/RTDs, Pressure Transmitters, Flow Meters สำหรับเชื้อเพลิง, และระบบป้องกันไฟไหม้</p>
            </section>
        </div>
        <div id="detail-content-cc_hrsg">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">HRSG (Heat Recovery Steam Generator)</h3>
            <span class="hidden" id="detail-topic-cc_hrsg">Control and Instrumentation for Heat Recovery Steam Generator (HRSG)</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Process Overview</h4>
                <p class="text-gray-600">HRSG ทำหน้าที่นำความร้อนทิ้งจากไอเสีย GT มาผลิตไอน้ำ แรงดันสูง กลาง และต่ำ เพื่อขับเคลื่อนกังหันไอน้ำ</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">C&amp;I Functions</h4>
                <p class="text-gray-600">การควบคุม: Feedwater Control (ควบคุมระดับน้ำในดรัม), Attemperator/Desuperheater Control (ควบคุมอุณหภูมิไอน้ำออก), และติดตั้ง Safety Valves</p>
            </section>
        </div>
        <div id="detail-content-cc_steamturbine">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Steam Turbine (ST) and BOP</h3>
            <span class="hidden" id="detail-topic-cc_steamturbine">Steam Turbine and Balance of Plant control systems in combined cycle power plants</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Steam Turbine Control</h4>
                <p class="text-gray-600">ระบบควบคุมความเร็ว (Governor) และระบบป้องกันอันตรายจากการเร่งความเร็วเกิน (Overspeed Trip System) ซึ่งเป็นงาน C&amp;I ที่มีความสำคัญสูงสุด</p>
            </section>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">BOP (Balance of Plant)</h4>
                <p class="text-gray-600">ควบคุมและเฝ้าระวังส่วนประกอบเสริม เช่น Condenser (วัดสูญญากาศและระดับน้ำ), Cooling Water Pumps, และ Demineralizer Plant</p>
            </section>
        </div>
        <div id="detail-content-cc_dcs">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">DCS (Distributed Control System)</h3>
            <span class="hidden" id="detail-topic-cc_dcs">DCS in Combined Cycle Power Plant.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Function</h4>
                <p class="text-gray-600">เป็นระบบควบคุมหลักที่ใช้ในการสั่งการ, ประมวลผล, และแสดงผลการทำงานทั้งหมดของโรงไฟฟ้า โดยมีสถาปัตยกรรมแบบกระจายศูนย์ (Distributed Architecture)</p>
            </section>
        </div>
        <div id="detail-content-cc_bms">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">BMS (Burner Management System)</h3>
            <span class="hidden" id="detail-topic-cc_bms">BMS in Combined Cycle Power Plant.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Function</h4>
                <p class="text-gray-600">ระบบความปลอดภัยที่รับผิดชอบในการจุดระเบิดและการดับฉุกเฉินของเตาเผา (Combustor) ใน GT หรือ Burner ใน Auxiliary Boiler ป้องกันการเกิดระเบิด</p>
            </section>
        </div>
        <div id="detail-content-cc_vibration">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Vibration Monitoring System</h3>
            <span class="hidden" id="detail-topic-cc_vibration">Vibration Monitoring System in Combined Cycle Power Plant</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Function</h4>
                <p class="text-gray-600">ติดตั้ง Probes และ Sensors เพื่อตรวจวัดการสั่นสะเทือนของแบริ่งและเพลาในกังหัน GT และ ST เพื่อประเมินสภาพเครื่องจักรแบบ Real-time</p>
            </section>
        </div>
        <div id="detail-content-cc_cems">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">CEMS (Continuous Emission Monitoring)</h3>
            <span class="hidden" id="detail-topic-cc_cems">CEMS in Combined Cycle Power Plant.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Function</h4>
                <p class="text-gray-600">ระบบวิเคราะห์ทางเคมีที่ติดตั้งที่ปล่องระบาย เพื่อวัดปริมาณมลพิษ (เช่น NOx, CO, SO2) อย่างต่อเนื่อง เพื่อให้เป็นไปตามข้อกำหนดด้านสิ่งแวดล้อม</p>
            </section>
        </div>
        <div id="detail-content-sp_dc_generation">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">C&amp;I Role in DC Generation (PV Array)</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Monitoring and Performance Check</h4>
                <p class="text-gray-600">การวัดกระแสและแรงดันไฟฟ้ากระแสตรง (DC) ในระดับ String และ Array เพื่อการตรวจสอบประสิทธิภาพ (Performance Monitoring) และการตรวจจับความผิดปกติ เช่น Hot Spots</p>
            </section>
        </div>
        <div id="detail-content-sp_ac_conversion">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">C&amp;I Role in AC Conversion (Inverter)</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Inverter Control and Grid Synchronization</h4>
                <p class="text-gray-600">การควบคุม Inverter ให้แปลง DC เป็น AC ด้วยคุณภาพสูงสุด การควบคุมกำลังไฟฟ้าส่งออก (Active/Reactive Power) และการซิงโครไนซ์กับระบบโครงข่าย</p>
            </section>
        </div>
        <div id="detail-content-sp_inverters">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Inverter and MPPT Control</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">MPPT Principle</h4>
                <p class="text-gray-600">MPPT (Maximum Power Point Tracking) คือฟังก์ชันการควบคุมที่ทำให้แผงโซลาร์เซลล์ผลิตกำลังไฟฟ้าได้สูงสุดภายใต้สภาพแสงที่เปลี่ยนแปลง ซึ่งเป็นบทบาทสำคัญของ Inverter</p>
            </section>
        </div>
        <div id="detail-content-sp_weather">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Weather Monitoring Station</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Sensors and Measurements</h4>
                <p class="text-gray-600">ติดตั้ง Pyranometer (วัดความเข้มแสง), Thermocouples (วัดอุณหภูมิแผง/อากาศ), และ Anemometer (วัดความเร็วลม) เพื่อนำข้อมูลมาคำนวณ Performance Ratio</p>
            </section>
        </div>
        <div id="detail-content-sp_protection">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Safety and Grid Protection</h3>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Key Protection Systems</h4>
                <p class="text-gray-600">ระบบป้องกันสำคัญ เช่น Ground Fault Detection, Anti-Islanding Protection (ป้องกันการจ่ายไฟเข้าโครงข่ายเมื่อโครงข่ายล้มเหลว), และ Surge Protection Devices</p>
            </section>
        </div>
        <div id="detail-content-sp_scada">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">SCADA/PPC (Plant Controller)</h3>
            <span class="hidden" id="detail-topic-sp_scada">SCADA/PPC in Solar Power Plant.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Control Function</h4>
                <p class="text-gray-600">ระบบ SCADA ใช้ในการควบคุมและเฝ้าระวังโรงไฟฟ้าทั้งหมด ส่วน PPC (Power Plant Controller) ใช้ในการควบคุมกำลังไฟฟ้าส่งออกตามคำสั่งของผู้ควบคุมระบบโครงข่าย (System Operator)</p>
            </section>
        </div>
        <div id="detail-content-sp_tracker">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">Tracking System C&amp;I</h3>
            <span class="hidden" id="detail-topic-sp_tracker">C&amp;I for Solar Tracking System.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Control and Maintenance</h4>
                <p class="text-gray-600">ในกรณีที่โรงไฟฟ้าใช้ระบบติดตามดวงอาทิตย์ (Tracker) งาน C&amp;I คือการดูแลมอเตอร์, Limit Switches, และระบบควบคุมเพื่อให้แผงเซลล์หันเข้าหาดวงอาทิตย์อย่างแม่นยำ</p>
            </section>
        </div>
        <div id="detail-content-sp_dccomps">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">DC Component Monitoring</h3>
            <span class="hidden" id="detail-topic-sp_dccomps">DC component monitoring in solar power plants.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Monitoring Technique</h4>
                <p class="text-gray-600">การวัดและบันทึกข้อมูล DC ในแต่ละ String และ Combiner Box เพื่อวิเคราะห์หา String ที่มีประสิทธิภาพต่ำกว่าปกติ (String Mismatch)</p>
            </section>
        </div>
        <div id="detail-content-sp_ir_temp">
            <h3 class="text-2xl font-bold text-egat-blue mb-4">IR Temperature Sensing</h3>
            <span class="hidden" id="detail-topic-sp_ir_temp">IR Temperature Sensing for PV arrays.</span>
            <section class="mb-6">
                <h4 class="text-lg font-semibold text-gray-700 mt-4 mb-2">Monitoring Technique</h4>
                <p class="text-gray-600">การใช้กล้องถ่ายภาพความร้อน (Infrared Camera) หรือเซ็นเซอร์วัดอุณหภูมิแบบไม่สัมผัสเพื่อตรวจจับความผิดปกติที่เกิดจากความร้อนสูง (เช่น Hot Spots) บนแผงเซลล์หรือจุดเชื่อมต่อ</p>
            </section>
        </div>
    </div>
    <script>
        // Data for modal content (Uses the hidden divs)
        const modalData = {
            'intro': document.getElementById('detail-content-intro').innerHTML,
            'core_work': document.getElementById('detail-content-core_work').innerHTML,
            'system_overview': document.getElementById('detail-content-system_overview').innerHTML,
            'maintenance': document.getElementById('detail-content-maintenance').innerHTML,
            'safety': document.getElementById('detail-content-safety').innerHTML,
            'future': document.getElementById('detail-content-future').innerHTML,
            'cc_brayton_cycle': document.getElementById('detail-content-cc_brayton_cycle').innerHTML,
            'cc_rankine_cycle': document.getElementById('detail-content-cc_rankine_cycle').innerHTML,
            'cc_gasturbine': document.getElementById('detail-content-cc_gasturbine').innerHTML,
            'cc_hrsg': document.getElementById('detail-content-cc_hrsg').innerHTML,
            'cc_steamturbine': document.getElementById('detail-content-cc_steamturbine').innerHTML,
            'cc_dcs': document.getElementById('detail-content-cc_dcs').innerHTML,
            'cc_bms': document.getElementById('detail-content-cc_bms').innerHTML,
            'cc_vibration': document.getElementById('detail-content-cc_vibration').innerHTML,
            'cc_cems': document.getElementById('detail-content-cc_cems').innerHTML,
            'sp_dc_generation': document.getElementById('detail-content-sp_dc_generation').innerHTML,
            'sp_ac_conversion': document.getElementById('detail-content-sp_ac_conversion').innerHTML,
            'sp_inverters': document.getElementById('detail-content-sp_inverters').innerHTML,
            'sp_weather': document.getElementById('detail-content-sp_weather').innerHTML,
            'sp_protection': document.getElementById('detail-content-sp_protection').innerHTML,
            'sp_scada': document.getElementById('detail-content-sp_scada').innerHTML,
            'sp_tracker': document.getElementById('detail-content-sp_tracker').innerHTML,
            'sp_dccomps': document.getElementById('detail-content-sp_dccomps').innerHTML,
            'sp_ir_temp': document.getElementById('detail-content-sp_ir_temp').innerHTML,
        };

        // Modal Elements
        const modal = document.getElementById('modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContentBox = document.getElementById('modal-content-box');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalContent = document.querySelector('.modal-content'); 

        // General Sections and Links
        const contentSections = document.querySelectorAll('.content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const detailCards = document.querySelectorAll('.detail-card');
        
        /**
         * Helper function to calculate the width of the scrollbar.
         * Used to prevent layout shift when modal is open and body scrolling is disabled.
         */
        function getScrollbarWidth() {
            // Create a temporary element to measure
            const outer = document.createElement('div');
            outer.style.visibility = 'hidden';
            outer.style.overflow = 'scroll'; // Show scrollbar
            outer.style.msOverflowStyle = 'scrollbar'; // IE
            document.body.appendChild(outer);

            const inner = document.createElement('div');
            outer.appendChild(inner);

            // Calculate width by subtracting the inner width from the outer width
            const scrollbarWidth = (outer.offsetWidth - inner.offsetWidth);

            // Remove the temporary element
            outer.parentNode.removeChild(outer);

            return scrollbarWidth;
        }

        // Function to convert the flat section HTML into an accordion structure
        function createAccordionHTML(flatHTML) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = flatHTML;

            // Extract the main title and optional topic span
            const mainTitleElement = tempDiv.querySelector('h3');
            const topicElement = tempDiv.querySelector('span[id^="detail-topic-"]');
            
            // Get all sections which will be accordion items
            const sections = tempDiv.querySelectorAll('section');
            let accordionHTML = '';

            sections.forEach((section, index) => {
                const header = section.querySelector('h4');
                const contentBody = section.innerHTML.replace(header.outerHTML, ''); // Get content without H4
                
                // Set the first item to be open by default
                const isOpen = index === 0;
                const headerClasses = isOpen ? 'text-egat-blue' : 'text-gray-700';
                const iconClasses = isOpen ? 'rotate-180 text-egat-blue' : 'text-gray-500';

                accordionHTML += `
                    <div class="accordion-item border-b border-gray-200 last:border-b-0">
                        <button class="accordion-header w-full flex justify-between items-center py-4 text-left ${headerClasses} hover:text-egat-blue transition duration-200 focus:outline-none">
                            <h4 class="text-lg font-semibold mt-0 mb-0">${header.textContent}</h4>
                            <svg class="w-5 h-5 accordion-icon transform transition duration-300 ${iconClasses}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content overflow-hidden transition-all duration-300 ease-in-out" style="max-height: ${isOpen ? '500px' : '0'};">
                            <div class="py-2 pb-4 text-gray-600 space-y-3">
                                ${contentBody}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            return {
                title: mainTitleElement ? mainTitleElement.textContent : 'Detail Information',
                content: accordionHTML
            };
        }

        // Function to show the content section
        function showSection(sectionId) {
            contentSections.forEach(section => {
                // Initial hide/fade out
                if (section.id !== sectionId) {
                    section.classList.add('hidden');
                    section.style.opacity = '0';
                }
            });

            // Fade in/show active section
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.remove('hidden');
                // Use setTimeout for transition to work after removing 'hidden'
                setTimeout(() => {
                    activeSection.style.opacity = '1';
                }, 10); 
            }

	        window.scrollTo({ top: 0, behavior: 'smooth' });

            // Update active link style
            navLinks.forEach(link => {
                link.classList.remove('nav-active-link', 'font-bold');
            });

            // Set active style for the main link or the parent link
            let activeLink = document.querySelector(`.nav-link[data-target="${sectionId}"]`);
            if (activeLink) {
                activeLink.classList.add('nav-active-link', 'font-bold');
            } else {
                // Check if it's a dropdown item (like combined_cycle) and set the parent ('training') as active
                const parentLink = document.querySelector(`.nav-dropdown-link[data-target="${sectionId}"]`);
                const parentId = parentLink?.getAttribute('data-parent-target');
                if (parentId) {
                    activeLink = document.querySelector(`.nav-link[data-target="${parentId}"]`);
                    activeLink?.classList.add('nav-active-link', 'font-bold');
                }
            }
        }

        // Accordion Logic
        function setupAccordion(accordionContainer) {
            const accordionHeaders = accordionContainer.querySelectorAll('.accordion-header');

            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const item = header.closest('.accordion-item');
                    const content = item.querySelector('.accordion-content');
                    const icon = header.querySelector('.accordion-icon');
                    
                    const isOpening = content.style.maxHeight === '0px';

                    // Close all other items (enforce single open)
                    accordionHeaders.forEach(otherHeader => {
                        const otherItem = otherHeader.closest('.accordion-item');
                        const otherContent = otherItem.querySelector('.accordion-content');
                        const otherIcon = otherHeader.querySelector('.accordion-icon');
                        
                        if (otherItem !== item) {
                            otherContent.style.maxHeight = '0px';
                            otherIcon.classList.remove('rotate-180', 'text-egat-blue');
                            otherIcon.classList.add('text-gray-500');
                            otherHeader.classList.remove('text-egat-blue');
                            otherHeader.classList.add('text-gray-700');
                        }
                    });

                    // Toggle the clicked item
                    if (isOpening) {
                        // Open
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.classList.add('rotate-180', 'text-egat-blue');
                        icon.classList.remove('text-gray-500');
                        header.classList.add('text-egat-blue');
                        header.classList.remove('text-gray-700');

                    } else {
                        // Close
                        content.style.maxHeight = '0px';
                        icon.classList.remove('rotate-180', 'text-egat-blue');
                        icon.classList.add('text-gray-500');
                        header.classList.remove('text-egat-blue');
                        header.classList.add('text-gray-700');
                    }
                });

                // Set a temporary max-height to ensure the transition works on open (for the first element)
                const content = header.closest('.accordion-item').querySelector('.accordion-content');
                if (content.style.maxHeight !== '0px') {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
            });
        }


        // Function to open the detail modal
        function openModal(detailId) {
            const content = modalData[detailId];
            if (!content) return;

            // 1. Convert flat content to accordion HTML
            const accordion = createAccordionHTML(content);

            // 2. Populate modal
            modalTitle.textContent = accordion.title;
            modalBody.innerHTML = accordion.content;
            
            // 3. Show modal and apply transition classes
            modal.classList.remove('hidden');
            
            // NEW FIX: Add padding to body to prevent layout shift from scrollbar disappearing
            const scrollbarWidth = getScrollbarWidth();
            const hasScrollbar = document.body.scrollHeight > window.innerHeight;
            
            if (hasScrollbar && scrollbarWidth > 0) {
                 document.body.style.paddingRight = `${scrollbarWidth}px`;
            }

            document.body.style.overflow = 'hidden'; 

            setTimeout(() => {
                modalBackdrop.style.opacity = '0.75';
                modalContentBox.classList.remove('scale-95', 'opacity-0');
                modalContentBox.classList.add('scale-100', 'opacity-100');
                
                // 4. Setup accordion functionality AFTER content is inserted and transitions start
                setupAccordion(modalBody);
            }, 10);
        }

        // Function to close the detail modal
        function closeModal() {
            modalBackdrop.style.opacity = '0';
            modalContentBox.classList.remove('scale-100', 'opacity-100');
            modalContentBox.classList.add('scale-95', 'opacity-0');
            
            // Revert changes after transition is complete
            setTimeout(() => {
                modal.classList.add('hidden');

                // NEW FIX: Restore body styles to re-enable scrolling and remove padding
                document.body.style.overflow = '';
                document.body.style.paddingRight = ''; 
            }, 300); // Wait for the transition to finish
        }

        // Initialize on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Set 'Overview' as default active section
            showSection('overview');

            // 1. Event Listener for Detail Cards to open Modal
            detailCards.forEach(card => {
                card.addEventListener('click', () => {
                    const detailId = card.dataset.detail;
                    openModal(detailId);
                });
            });
            
            // 2. Event Listener for Menu Links (including Dropdown Links) to switch sections
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Prevent default for main links that only serve as dropdown headers (href="#")
                    if (link.getAttribute('href') === '#') {
                        e.preventDefault(); 
                        return;
                    }
                    
                    e.preventDefault(); 
                    const sectionId = link.getAttribute('data-target');
                    showSection(sectionId);
                    
                    // Close dropdown menu after clicking an item
                    if (link.classList.contains('nav-dropdown-link')) {
                         // Use .group-hover to control the dropdown state, no immediate hiding is needed for good UX
                         // However, to force hide *after* a click, we can set display to none.
                         link.closest('.dropdown').querySelector('.dropdown-menu').style.display = 'none';
                    }
                });
            });


            // 3. Event Listener for Modal Backdrop/Outside click to close modal
            modalBackdrop.addEventListener('click', closeModal);
		
            modalContentBox.addEventListener('click', (e) => {
                // Close if click is directly on the modal content box (outside the inner content)
            	if (e.target === modalContentBox) {
            		closeModal();
       	        }
	        });
            
            // 4. Stop click propagation inside the modal content
            if (modalContent) {
                modalContent.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                });
            }

            // 5. Close Modal on Escape key press
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });

            // 6. Manage Dropdown display state on hover
            document.querySelectorAll('.dropdown').forEach(dropdown => {
                const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                // Use mouseenter/mouseleave to ensure display: block is set, overriding the initial CSS 'display: none'
                dropdown.addEventListener('mouseenter', () => {
                    dropdownMenu.style.display = 'block';
                });
                dropdown.addEventListener('mouseleave', () => {
                    // Use a short delay before hiding
                    setTimeout(() => {
                        if (!dropdown.matches(':hover')) {
                            dropdownMenu.style.display = 'none';
                        }
                    }, 500); 
                });
            });
        });
    </script>
    <button class="fixed bottom-6 right-6 bg-egat-yellow text-egat-blue p-3 rounded-full shadow-lg hover:bg-yellow-400 transition duration-300" id="darkModeToggle">
        <svg id="sunIcon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <svg id="moonIcon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
    </button>
    <script>
        const toggle = document.getElementById('darkModeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        // --- Initial State Check (New) ---
        // Since the body has 'dark' class by default, hide the moon (current state)
        // and show the sun (next state).
        if (document.body.classList.contains('dark')) {
            moonIcon.classList.add('hidden');
            sunIcon.classList.remove('hidden');
        } else {
            // Fallback for if 'dark' class is removed from the HTML
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }
        // ---------------------------------
        
        toggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
        
            if (document.body.classList.contains('dark')) {
                // Switched to Dark Mode (Show Sun to toggle to Light)
                document.body.style.backgroundColor = '#1C2833';
                document.body.style.color = '#EAECEE';
                sunIcon.classList.remove('hidden'); // Show Sun
                moonIcon.classList.add('hidden');   // Hide Moon
            } else {
                // Switched to Light Mode (Show Moon to toggle to Dark)
                document.body.style.backgroundColor = '#ffffff';
                document.body.style.color = '#000000';
                sunIcon.classList.add('hidden');    // Hide Sun
                moonIcon.classList.remove('hidden'); // Show Moon
            }
        });
    </script>
</body>

</html>
